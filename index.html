<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Map User Location</title>
    
    <!-- Harici CSS Dosyası -->
    <link rel="stylesheet" href="style.css">

    <!-- Leaflet CSS ve JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>

    </head>

<body>
    <!-- Toggle Butonu -->
    <button class="sidebar-toggle">☰</button>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <img src="https://star.ee.hacettepe.edu.tr/assets/localImages/huEN2018.png" alt="Hacettepe University Logo" class="university-logo">
        <a href="#services" id="toggleCafesList">İşletmeler</a> <!-- İşletmeler butonu için id eklendi -->
        <div id="cafesList" class="cafes-list">
            <ul id="cafesChecklist"></ul>
        </div>
        
    </div>
        
    </div>

    <!-- İçerik -->
    <div class="content">
        <div id="map"></div>
    </div>

    <!-- Leaflet Harita Kodları -->
    <script>
// Harita ve markerlar için global değişkenler

var map;
var markers = {};
    document.getElementById('toggleCafesList').addEventListener('click', function() {
        var cafesList = document.getElementById('cafesList');
        cafesList.classList.toggle('show-cafes-list'); // show-cafes-list sınıfını ekleyip çıkarır
    });

    document.addEventListener('DOMContentLoaded', function() {
    map = L.map('map', {
        center: [39.8687, 32.7322],
        zoom: 15,
        zoomControl: false
    });

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Cafe listesi ve markerları yükle
    loadCafes();
});

function loadCafes() {
    fetch('http://localhost:3301/cafes')
        .then(response => response.json())
        .then(data => {
            var cafesList = document.getElementById('cafesChecklist');
            data.forEach(cafe => {
                var lat = parseFloat(cafe.cafe_lat);
                var lon = parseFloat(cafe.cafe_lon);

                var marker = L.marker([lat, lon]).bindPopup(`<b>${cafe.cafe_name}</b><br>${cafe.cafe_desc || 'Açıklama yok'}`);
                marker.addTo(map);

                markers[cafe.id] = marker;
                marker.addTo(map);

                // Cafe listesi için eleman oluştur
                var listItem = document.createElement('li');
                var label = document.createElement('label');
                var checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = true;
                checkbox.onchange = function() {
                    toggleMarker(cafe.id);
                };
                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(cafe.cafe_name));
                listItem.appendChild(label);
                cafesList.appendChild(listItem);
            });
        })
        .catch(error => console.error('Error fetching the cafes:', error));
}

function toggleMarker(cafeId) {
    if (markers[cafeId]) {
        if (map.hasLayer(markers[cafeId])) {
            map.removeLayer(markers[cafeId]);
        } else {
            map.addLayer(markers[cafeId]);
        }
    }
}


    </script>

    <!-- Harici JavaScript Dosyası -->
    <script src="script.js"></script>
</body>
</html>
