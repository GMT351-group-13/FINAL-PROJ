<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Map User Location</title>
    
    <!-- Harici CSS Dosyası -->
    <link rel="stylesheet" href="style.css">

    <!-- Leaflet CSS ve JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>

    </head>

<body>
    <!-- Toggle Butonu -->
    <button class="sidebar-toggle">☰</button>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <a href="#home">HACETTEPE ÜNİVERSİTESİ</a>
        <!-- Checkbox olarak değiştirilen İşletmeler butonu -->
        <label class="checkbox-container">
            İşletmeler
            <input type="checkbox" id="toggleCafes" checked>
            <span class="checkmark"></span>
        </label>
        <a href="#contact">Yorum</a>
    </div>

    <!-- İçerik -->
    <div class="content">
        <div id="map"></div>
    </div>

    <!-- Leaflet Harita Kodları -->
    <script>
// Harita ve markerlar için global değişkenler
var map;
var markers = [];

document.addEventListener('DOMContentLoaded', function() {
    map = L.map('map', {
        center: [39.8687, 32.7322],
        zoom: 15,
        zoomControl: false
    });

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
    }).addTo(map);

    fetchMarkers();
});

// Markerları çek ve göster
function fetchMarkers() {
    fetch('http://localhost:3300/cafes')
        .then(response => response.json())
        .then(data => {
            data.forEach(cafe => {
                var lat = parseFloat(cafe.cafe_lat);
                var lon = parseFloat(cafe.cafe_lon);
                var marker = L.marker([lat, lon]).bindPopup(`<b>${cafe.cafe_name}</b><br>${cafe.cafe_desc || 'Açıklama yok'}`);
                markers.push(marker);
                marker.addTo(map);
            });
        })
        .catch(error => console.error('Error fetching the cafes:', error));
}

// Checkbox kontrol fonksiyonu
document.getElementById('toggleCafes').addEventListener('change', function(e) {
    if (e.target.checked) {
        // Markerları göster
        markers.forEach(marker => marker.addTo(map));
    } else {
        // Markerları gizle
        markers.forEach(marker => map.removeLayer(marker));
    }
});


    </script>

    <!-- Harici JavaScript Dosyası -->
    <script src="script.js"></script>
</body>
</html>
